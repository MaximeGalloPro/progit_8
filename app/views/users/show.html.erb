<div class="max-w-4xl mx-auto">
  <!-- Header Card -->
  <div class="bg-slate-800 rounded-2xl shadow-2xl p-8 border border-slate-700 mb-6">
    <div class="flex items-center space-x-6">
      <div class="flex-shrink-0">
        <% if @user.avatar_url.present? %>
          <%= image_tag @user.avatar_url_with_size(200), alt: @user.name, class: "h-24 w-24 rounded-full ring-4 ring-blue-500/20" %>
        <% else %>
          <div class="h-24 w-24 rounded-full bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center ring-4 ring-blue-500/20">
            <span class="text-3xl font-bold text-white"><%= @user.name&.first&.upcase || "?" %></span>
          </div>
        <% end %>
      </div>
      <div class="flex-1">
        <p class="text-sm font-medium text-slate-400"><%= t('.welcome_back') %></p>
        <h1 class="text-3xl font-bold text-white mt-1"><%= @user.name %></h1>
        <p class="text-sm text-slate-300 mt-1"><%= @user.email_address %></p>
      </div>
    </div>
  </div>

  <!-- Edit Form Card -->
  <div class="bg-slate-800 rounded-2xl shadow-2xl p-8 border border-slate-700 mb-6">
    <h2 class="text-xl font-bold text-white mb-6"><%= t('.profile_settings') %></h2>

    <%= form_with model: @user, url: user_path, method: :patch, class: "space-y-6" do |form| %>
      <% if @user.errors.any? %>
        <div class="rounded-lg bg-gradient-to-r from-red-500/10 to-rose-500/10 border border-red-500/20 p-4">
          <h3 class="text-sm font-medium text-red-400 mb-2">
            <%= pluralize(@user.errors.count, "erreur") %> ont empêché l'enregistrement de ce profil :</h3>
          <ul class="list-disc list-inside space-y-1 text-sm text-red-300">
            <% @user.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div>
        <%= form.label :nickname, t('.nickname_label'), class: "block text-sm font-medium text-slate-300 mb-2" %>
        <div class="flex gap-3">
          <%= form.text_field :nickname,
              placeholder: t('.nickname_label'),
              class: "flex-1 rounded-lg bg-slate-700 px-4 py-3 text-white placeholder:text-slate-400 border border-slate-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" %>
          <%= form.submit t('.save_button'), class: "rounded-lg bg-gradient-to-r from-blue-600 to-blue-500 px-6 py-3 text-sm font-semibold text-white shadow-lg hover:from-blue-500 hover:to-blue-400 transition-all hover:scale-[1.02] cursor-pointer" %>
        </div>
      </div>

      <% if @user.oauth_user? %>
        <div class="border-t border-slate-700 pt-6">
          <% if @user.password_digest.present? %>
            <h3 class="text-sm font-medium text-slate-300 mb-2"><%= t('.change_password') %></h3>
            <p class="text-xs text-slate-400 mb-4"><%= t('.change_password_help') %></p>
          <% else %>
            <h3 class="text-sm font-medium text-yellow-400 mb-2"><%= t('.set_password_warning') %></h3>
            <p class="text-xs text-red-400 font-medium mb-4"><%= t('.set_password_help') %></p>
          <% end %>
          <%= form.label :password, t('.password_label'), class: "block text-sm font-medium text-slate-300 mb-2" %>
          <%= form.password_field :password,
              placeholder: "Enter password (min. 8 characters)",
              class: "block w-full rounded-lg bg-slate-700 px-4 py-3 text-white placeholder:text-slate-400 border border-slate-600 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" %>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Account Information Card -->
  <div class="bg-slate-800 rounded-2xl shadow-2xl p-8 border border-slate-700 mb-6">
    <h2 class="text-xl font-bold text-white mb-6"><%= t('.account_information') %></h2>

    <dl class="space-y-6">
      <div class="flex items-center justify-between py-4 border-b border-slate-700">
        <dt class="text-sm font-medium text-slate-400"><%= t('.full_name') %></dt>
        <dd class="text-sm text-white font-medium"><%= @user.name %></dd>
      </div>

      <div class="flex items-center justify-between py-4 border-b border-slate-700">
        <dt class="text-sm font-medium text-slate-400"><%= t('.email_address') %></dt>
        <dd class="text-sm text-white font-medium"><%= @user.email_address %></dd>
      </div>

      <div class="flex items-center justify-between py-4 border-b border-slate-700">
        <dt class="text-sm font-medium text-slate-400"><%= t('.account_type') %></dt>
        <dd class="flex items-center gap-4">
          <% if @user.oauth_user? %>
            <span class="inline-flex items-center gap-1.5 rounded-lg bg-blue-500/10 px-3 py-1.5 text-xs font-medium text-blue-400 ring-1 ring-inset ring-blue-500/20">
              <span class="h-1.5 w-1.5 rounded-full bg-blue-400"></span>
              <%= t('.google_account') %>
            </span>
          <% else %>
            <span class="inline-flex items-center rounded-lg bg-slate-700 px-3 py-1.5 text-xs font-medium text-slate-300 ring-1 ring-inset ring-slate-600"><%= t('.email_password') %></span>
          <% end %>

          <% if @user.oauth_user? %>
            <% if @user.password_digest.present? %>
              <%= button_to unlink_google_user_path, method: :delete,
                  data: { turbo_confirm: t('.confirm_unlink_google') },
                  class: "text-xs text-red-400 hover:text-red-300 font-medium bg-transparent border-0 p-0 cursor-pointer transition-colors" do %>
                <%= t('.unlink_google') %>
              <% end %>
            <% else %>
              <span class="text-xs text-slate-500 font-medium cursor-not-allowed"><%= t('.unlink_google') %></span>
            <% end %>
          <% else %>
            <%= button_to t('.link_google'), link_google_user_path, method: :post,
                class: "text-xs text-blue-400 hover:text-blue-300 font-medium bg-transparent border-0 p-0 cursor-pointer transition-colors" %>
          <% end %>
        </dd>
      </div>

      <% if !@user.oauth_user? || !@user.password_digest.present? %>
        <% if !@user.password_digest.present? %>
          <div class="rounded-lg bg-red-500/10 border border-red-500/20 p-4">
            <p class="text-xs text-red-400 font-medium"><%= t('.warning_set_password_to_unlink') %></p>
          </div>
        <% end %>
      <% end %>

      <div class="flex items-center justify-between py-4">
        <dt class="text-sm font-medium text-slate-400"><%= t('.role') %></dt>
        <dd>
          <% case @user.role %>
          <% when "admin" %>
            <span class="inline-flex items-center gap-1.5 rounded-lg bg-purple-500/10 px-3 py-1.5 text-xs font-medium text-purple-400 ring-1 ring-inset ring-purple-500/20">
              <span class="h-1.5 w-1.5 rounded-full bg-purple-400"></span>
              <%= t('.administrator') %>
            </span>
          <% when "moderator" %>
            <span class="inline-flex items-center gap-1.5 rounded-lg bg-yellow-500/10 px-3 py-1.5 text-xs font-medium text-yellow-400 ring-1 ring-inset ring-yellow-500/20">
              <span class="h-1.5 w-1.5 rounded-full bg-yellow-400"></span>
              <%= t('.moderator') %>
            </span>
          <% else %>
            <span class="inline-flex items-center gap-1.5 rounded-lg bg-green-500/10 px-3 py-1.5 text-xs font-medium text-green-400 ring-1 ring-inset ring-green-500/20">
              <span class="h-1.5 w-1.5 rounded-full bg-green-400"></span>
              <%= t('.user') %>
            </span>
          <% end %>
        </dd>
      </div>
    </dl>
  </div>

  <!-- Actions Card -->
  <div class="bg-slate-800 rounded-2xl shadow-2xl p-8 border border-slate-700">
    <h2 class="text-xl font-bold text-white mb-6"><%= t('.danger_zone') %></h2>

    <div class="flex flex-col sm:flex-row gap-4">
      <%= button_to session_path, method: :delete, class: "inline-flex justify-center items-center rounded-lg bg-slate-700 border border-slate-600 px-6 py-3 text-sm font-semibold text-white hover:bg-slate-600 transition-all hover:scale-[1.02]" do %>
        <svg class="-ml-0.5 mr-2 h-5 w-5 text-slate-400" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M3 4.25A2.25 2.25 0 015.25 2h5.5A2.25 2.25 0 0113 4.25v2a.75.75 0 01-1.5 0v-2a.75.75 0 00-.75-.75h-5.5a.75.75 0 00-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 00.75-.75v-2a.75.75 0 011.5 0v2A2.25 2.25 0 0110.75 18h-5.5A2.25 2.25 0 013 15.75V4.25z" clip-rule="evenodd" />
          <path fill-rule="evenodd" d="M19 10a.75.75 0 00-.75-.75H8.704l1.048-.943a.75.75 0 10-1.004-1.114l-2.5 2.25a.75.75 0 000 1.114l2.5 2.25a.75.75 0 101.004-1.114l-1.048-.943h9.546A.75.75 0 0019 10z" clip-rule="evenodd" />
        </svg>
        <%= t('.sign_out') %>
      <% end %>

      <%= button_to user_path, method: :delete, data: { turbo_confirm: t('.confirm_delete') }, class: "inline-flex justify-center items-center rounded-lg bg-gradient-to-r from-red-600 to-red-500 px-6 py-3 text-sm font-semibold text-white shadow-lg hover:from-red-500 hover:to-red-400 transition-all hover:scale-[1.02]" do %>
        <svg class="-ml-0.5 mr-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd" />
        </svg>
        <%= t('.delete_account') %>
      <% end %>
    </div>
  </div>
</div>
